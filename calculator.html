<!DOCTYPE html>
<html lang="en" class="antialiased scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compound Interest Calculator | Virelia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: #000000;
            overflow-x: hidden;
        }
        
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #ffffff;
        }
        ::-webkit-scrollbar-thumb {
            background: #e2e8f0;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #cbd5e1;
        }

        /* Calculator specific styles */
        .currency-wrapper {
            position: relative;
        }

        .currency-symbol {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666666;
            font-weight: 500;
        }

        .currency-wrapper input {
            padding-left: 28px;
        }
        
        .currency-select {
            width: auto;
            padding-right: 24px;
            border: none;
            background: transparent;
            font-weight: 600;
            color: #1f1738;
            cursor: pointer;
            appearance: none; 
        }

        .toggle-container {
            display: flex;
            background: #ffffff;
            border: 1px solid #E0E0E0;
            border-radius: 6px;
            padding: 2px;
            margin-top: 5px;
        }

        .toggle-btn {
            flex: 1;
            padding: 6px;
            text-align: center;
            font-size: 0.8rem;
            cursor: pointer;
            border-radius: 4px;
            color: #666666;
            transition: 0.2s;
        }

        .toggle-btn.active {
            background-color: #1f1738;
            color: #ffffff;
        }

        td[contenteditable="true"] {
            cursor: text;
            background: #fff;
            transition: background 0.2s;
        }
        
        td[contenteditable="true"]:hover {
            background: #f9f9f9;
        }
        
        td[contenteditable="true"]:focus {
            outline: 2px solid #1f1738;
            background: #ffffff;
            border-radius: 4px;
        }

        tr.selected-row {
            background-color: rgba(31, 23, 56, 0.1);
        }
        
        tr:hover:not(.selected-row) {
            background-color: rgba(0,0,0,0.02);
        }

        .tab-btn {
            color: #666666;
        }

        .tab-btn.active {
            background-color: #1f1738;
            color: #ffffff;
        }

        .b-toggle-btn {
            color: #666666;
        }

        .b-toggle-btn.active {
            background-color: #1f1738;
            color: #ffffff;
        }
    </style>
</head>
<body class="selection:bg-[#ede9fe] selection:text-[#1a1230]">

    <!-- Floating Navbar -->
    <div class="fixed top-2 md:top-4 left-0 right-0 z-50 flex justify-center px-3 md:px-4">
        <nav class="bg-white/90 backdrop-blur-md border border-[#e9d5ff]/60 rounded-full px-4 md:px-8 py-3 md:py-5 flex items-center justify-between shadow-lg shadow-[#1f1738]/20 max-w-6xl w-full">
            <!-- Logo - Mobile -->
            <a href="index.html" class="flex items-center gap-2 group md:hidden">
                <img src="https://storage.googleapis.com/msgsndr/D9EwGrg33pctwAN0KYGQ/media/689617b36346f4ec25540b89.png" alt="Virelia" class="h-10 w-auto object-contain grayscale brightness-0 opacity-80 group-hover:opacity-100 transition-all duration-300">
            </a>
            
            <!-- Logo - Desktop -->
            <a href="index.html" class="hidden md:flex items-center gap-2 group">
                <img src="https://storage.googleapis.com/msgsndr/D9EwGrg33pctwAN0KYGQ/media/689617b36346f4ec25540b89.png" alt="Virelia" class="h-16 w-auto object-contain grayscale brightness-0 opacity-80 group-hover:opacity-100 transition-all duration-300">
            </a>
            
            <!-- Centered Navigation - Desktop -->
            <div class="hidden md:flex items-center gap-6 lg:gap-8 text-sm font-medium text-slate-600 flex-1 justify-center">
                <a href="index.html#virelia-standard" class="hover:text-[#1f1738] transition-colors relative group">
                    The Standard
                    <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-[#1f1738] group-hover:w-full transition-all duration-300"></span>
                </a>
                <a href="index.html#choose-path" class="hover:text-[#1f1738] transition-colors relative group">
                    Pathways
                    <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-[#1f1738] group-hover:w-full transition-all duration-300"></span>
                </a>
                <a href="index.html#leadership" class="hover:text-[#1f1738] transition-colors relative group">
                    About
                    <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-[#1f1738] group-hover:w-full transition-all duration-300"></span>
                </a>
                <div class="relative group">
                    <a href="life-insurance-intro.html" class="hover:text-[#1f1738] transition-colors relative font-semibold text-[#1f1738] flex items-center gap-1">
                        Life Insurance
                        <i data-lucide="chevron-down" class="w-4 h-4"></i>
                    </a>
                    <div class="absolute top-full left-1/2 -translate-x-1/2 mt-2 w-64 bg-white rounded-2xl shadow-2xl border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50 p-2">
                        <a href="life-insurance-intro.html" class="block px-4 py-3 rounded-lg hover:bg-gray-50 text-black text-sm transition-colors">
                            <div class="font-semibold mb-1">Get Started</div>
                            <div class="text-xs text-gray-600">Protect your family's future</div>
                        </a>
                        <a href="life-insurance-types.html" class="block px-4 py-3 rounded-lg hover:bg-gray-50 text-black text-sm transition-colors">
                            <div class="font-semibold mb-1">4 Types Explained</div>
                            <div class="text-xs text-gray-600">Term, Whole, Universal, Seg Funds</div>
                        </a>
                        <a href="life-insurance-disability.html" class="block px-4 py-3 rounded-lg hover:bg-gray-50 text-black text-sm transition-colors">
                            <div class="font-semibold mb-1">Disability & Health</div>
                            <div class="text-xs text-gray-600">Protect your paycheck</div>
                        </a>
                        <a href="life-insurance-segfunds.html" class="block px-4 py-3 rounded-lg hover:bg-gray-50 text-black text-sm transition-colors">
                            <div class="font-semibold mb-1">Advanced Planning</div>
                            <div class="text-xs text-gray-600">Seg funds & tax strategies</div>
                        </a>
                    </div>
                </div>
                <div class="relative group">
                    <a href="tfsa.html" class="hover:text-[#1f1738] transition-colors relative font-semibold text-[#1f1738] flex items-center gap-1">
                        Accounts
                        <i data-lucide="chevron-down" class="w-4 h-4"></i>
                    </a>
                    <div class="absolute top-full left-1/2 -translate-x-1/2 mt-2 w-72 bg-white rounded-2xl shadow-2xl border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50 p-2 max-h-[80vh] overflow-y-auto">
                        <div class="grid grid-cols-2 gap-1">
                            <a href="tfsa.html" class="block px-3 py-2 rounded-lg hover:bg-green-50 text-black text-xs transition-colors">
                                <div class="font-semibold mb-0.5 text-green-700">TFSA</div>
                                <div class="text-[10px] text-gray-600">Tax-Free Savings</div>
                            </a>
                            <a href="rrsp.html" class="block px-3 py-2 rounded-lg hover:bg-blue-50 text-black text-xs transition-colors">
                                <div class="font-semibold mb-0.5 text-blue-700">RRSP</div>
                                <div class="text-[10px] text-gray-600">Retirement Savings</div>
                            </a>
                            <a href="fhsa.html" class="block px-3 py-2 rounded-lg hover:bg-orange-50 text-black text-xs transition-colors">
                                <div class="font-semibold mb-0.5 text-orange-700">FHSA</div>
                                <div class="text-[10px] text-gray-600">First Home Savings</div>
                            </a>
                            <a href="rrif.html" class="block px-3 py-2 rounded-lg hover:bg-purple-50 text-black text-xs transition-colors">
                                <div class="font-semibold mb-0.5 text-purple-700">RRIF</div>
                                <div class="text-[10px] text-gray-600">Retirement Income</div>
                            </a>
                            <a href="resp.html" class="block px-3 py-2 rounded-lg hover:bg-pink-50 text-black text-xs transition-colors">
                                <div class="font-semibold mb-0.5 text-pink-700">RESP</div>
                                <div class="text-[10px] text-gray-600">Education Savings</div>
                            </a>
                            <a href="gic.html" class="block px-3 py-2 rounded-lg hover:bg-teal-50 text-black text-xs transition-colors">
                                <div class="font-semibold mb-0.5 text-teal-700">GIC</div>
                                <div class="text-[10px] text-gray-600">Guaranteed Investment</div>
                            </a>
                            <a href="cash-value-life-insurance.html" class="block px-3 py-2 rounded-lg hover:bg-amber-50 text-black text-xs transition-colors">
                                <div class="font-semibold mb-0.5 text-amber-700">Cash Value</div>
                                <div class="text-[10px] text-gray-600">Life Insurance</div>
                            </a>
                            <a href="hisa.html" class="block px-3 py-2 rounded-lg hover:bg-emerald-50 text-black text-xs transition-colors">
                                <div class="font-semibold mb-0.5 text-emerald-700">HISA</div>
                                <div class="text-[10px] text-gray-600">High-Interest Savings</div>
                            </a>
                            <a href="rdsp.html" class="block px-3 py-2 rounded-lg hover:bg-violet-50 text-black text-xs transition-colors">
                                <div class="font-semibold mb-0.5 text-violet-700">RDSP</div>
                                <div class="text-[10px] text-gray-600">Disability Savings</div>
                            </a>
                            <a href="spousal-rrsp.html" class="block px-3 py-2 rounded-lg hover:bg-rose-50 text-black text-xs transition-colors">
                                <div class="font-semibold mb-0.5 text-rose-700">Spousal RRSP</div>
                                <div class="text-[10px] text-gray-600">Income Splitting</div>
                            </a>
                            <a href="calculator.html" class="block px-3 py-2 rounded-lg hover:bg-indigo-50 text-black text-xs transition-colors">
                                <div class="font-semibold mb-0.5 text-indigo-700">Calculator</div>
                                <div class="text-[10px] text-gray-600">Compound Interest</div>
                            </a>
                        </div>
                    </div>
                </div>
                <a href="dentist-tax.html" class="hover:text-[#1f1738] transition-colors relative group">
                    Tax
                    <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-[#1f1738] group-hover:w-full transition-all duration-300"></span>
                </a>
            </div>

            <!-- Mobile Menu Button -->
            <button id="mobile-menu-btn" class="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors">
                <i data-lucide="menu" class="w-6 h-6 text-slate-600"></i>
            </button>

            <!-- CTA Button - Desktop -->
            <div class="hidden md:flex items-center">
                <a href="book-appointment.html" class="px-4 md:px-6 py-2 md:py-3 bg-gradient-to-r from-[#1f1738] to-[#1a1230] text-[#f5f3ed] text-xs md:text-sm font-semibold rounded-full hover:from-[#1a1230] hover:to-[#1f1538] transition-colors flex items-center gap-2 shadow-md shadow-[#1f1738]/50">
                    <span class="hidden sm:inline">Get Started</span>
                    <span class="sm:hidden">Start</span>
                    <i data-lucide="arrow-right" class="w-3 h-3 md:w-4 md:h-4"></i>
                </a>
            </div>
        </nav>
    </div>

    <!-- Modern Glassmorphic Mobile Menu -->
    <div id="mobile-menu" class="fixed top-0 left-0 right-0 bottom-0 z-40 hidden md:hidden">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-[#1f1738]/40 backdrop-blur-sm"></div>
        
        <!-- Menu Content -->
        <div class="relative h-full flex flex-col">
            <!-- Header -->
            <div class="bg-white/95 backdrop-blur-xl border-b border-[#e9d5ff]/60 shadow-lg px-4 py-4 flex items-center justify-between">
                <img src="https://storage.googleapis.com/msgsndr/D9EwGrg33pctwAN0KYGQ/media/689617b36346f4ec25540b89.png" alt="Virelia" class="h-10 w-auto grayscale brightness-0 opacity-80">
                <button id="mobile-menu-close" class="p-2 rounded-xl hover:bg-gray-100 transition-colors">
                    <i data-lucide="x" class="w-6 h-6 text-slate-600"></i>
                </button>
            </div>
            
            <!-- Scrollable Menu -->
            <div class="flex-1 overflow-y-auto bg-gradient-to-b from-white/95 to-white/90 backdrop-blur-xl">
                <nav class="px-4 py-6 flex flex-col gap-3">
                    <!-- Standard Links -->
                    <a href="index.html#virelia-standard" class="py-3 px-4 rounded-xl bg-white/60 backdrop-blur-sm hover:bg-white/80 transition-all text-slate-700 font-medium hover:text-[#1f1738] flex items-center justify-between shadow-sm hover:shadow-md border border-gray-100/50">
                        <span>The Standard</span>
                        <i data-lucide="chevron-right" class="w-4 h-4"></i>
                    </a>
                    <a href="index.html#choose-path" class="py-3 px-4 rounded-xl bg-white/60 backdrop-blur-sm hover:bg-white/80 transition-all text-slate-700 font-medium hover:text-[#1f1738] flex items-center justify-between shadow-sm hover:shadow-md border border-gray-100/50">
                        <span>Pathways</span>
                        <i data-lucide="chevron-right" class="w-4 h-4"></i>
                    </a>
                    <a href="index.html#leadership" class="py-3 px-4 rounded-xl bg-white/60 backdrop-blur-sm hover:bg-white/80 transition-all text-slate-700 font-medium hover:text-[#1f1738] flex items-center justify-between shadow-sm hover:shadow-md border border-gray-100/50">
                        <span>About</span>
                        <i data-lucide="chevron-right" class="w-4 h-4"></i>
                    </a>
                    
                    <!-- Life Insurance Dropdown -->
                    <div class="py-3 px-4 rounded-xl bg-gradient-to-br from-[#1f1738]/10 to-[#251a3d]/5 backdrop-blur-sm border border-[#1f1738]/20 shadow-sm">
                        <div class="font-semibold text-[#1f1738] mb-3 flex items-center gap-2">
                            <i data-lucide="shield-heart" class="w-4 h-4"></i>
                            Life Insurance
                        </div>
                        <div class="flex flex-col gap-2 ml-2">
                            <a href="life-insurance-intro.html" class="text-sm text-slate-600 hover:text-[#1f1738] transition-colors py-1">Get Started</a>
                            <a href="life-insurance-types.html" class="text-sm text-slate-600 hover:text-[#1f1738] transition-colors py-1">4 Types Explained</a>
                            <a href="life-insurance-disability.html" class="text-sm text-slate-600 hover:text-[#1f1738] transition-colors py-1">Disability & Health</a>
                            <a href="life-insurance-segfunds.html" class="text-sm text-slate-600 hover:text-[#1f1738] transition-colors py-1">Advanced Planning</a>
                        </div>
                    </div>
                    
                    <!-- Accounts Dropdown -->
                    <div class="py-3 px-4 rounded-xl bg-gradient-to-br from-green-50/80 to-blue-50/80 backdrop-blur-sm border border-green-200/50 shadow-sm">
                        <div class="font-semibold text-[#1f1738] mb-3 flex items-center gap-2">
                            <i data-lucide="wallet" class="w-4 h-4"></i>
                            Accounts & Savings
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <a href="tfsa.html" class="text-xs text-slate-700 hover:text-green-700 transition-colors py-2 px-2 rounded-lg hover:bg-white/60 font-medium">
                                <div class="text-green-700">TFSA</div>
                                <div class="text-[10px] text-gray-600">Tax-Free</div>
                            </a>
                            <a href="rrsp.html" class="text-xs text-slate-700 hover:text-blue-700 transition-colors py-2 px-2 rounded-lg hover:bg-white/60 font-medium">
                                <div class="text-blue-700">RRSP</div>
                                <div class="text-[10px] text-gray-600">Retirement</div>
                            </a>
                            <a href="fhsa.html" class="text-xs text-slate-700 hover:text-orange-700 transition-colors py-2 px-2 rounded-lg hover:bg-white/60 font-medium">
                                <div class="text-orange-700">FHSA</div>
                                <div class="text-[10px] text-gray-600">First Home</div>
                            </a>
                            <a href="rrif.html" class="text-xs text-slate-700 hover:text-purple-700 transition-colors py-2 px-2 rounded-lg hover:bg-white/60 font-medium">
                                <div class="text-purple-700">RRIF</div>
                                <div class="text-[10px] text-gray-600">Income Fund</div>
                            </a>
                            <a href="resp.html" class="text-xs text-slate-700 hover:text-pink-700 transition-colors py-2 px-2 rounded-lg hover:bg-white/60 font-medium">
                                <div class="text-pink-700">RESP</div>
                                <div class="text-[10px] text-gray-600">Education</div>
                            </a>
                            <a href="gic.html" class="text-xs text-slate-700 hover:text-teal-700 transition-colors py-2 px-2 rounded-lg hover:bg-white/60 font-medium">
                                <div class="text-teal-700">GIC</div>
                                <div class="text-[10px] text-gray-600">Guaranteed</div>
                            </a>
                            <a href="cash-value-life-insurance.html" class="text-xs text-slate-700 hover:text-amber-700 transition-colors py-2 px-2 rounded-lg hover:bg-white/60 font-medium">
                                <div class="text-amber-700">Cash Value</div>
                                <div class="text-[10px] text-gray-600">Life Insurance</div>
                            </a>
                            <a href="hisa.html" class="text-xs text-slate-700 hover:text-emerald-700 transition-colors py-2 px-2 rounded-lg hover:bg-white/60 font-medium">
                                <div class="text-emerald-700">HISA</div>
                                <div class="text-[10px] text-gray-600">High Interest</div>
                            </a>
                            <a href="rdsp.html" class="text-xs text-slate-700 hover:text-violet-700 transition-colors py-2 px-2 rounded-lg hover:bg-white/60 font-medium">
                                <div class="text-violet-700">RDSP</div>
                                <div class="text-[10px] text-gray-600">Disability</div>
                            </a>
                            <a href="spousal-rrsp.html" class="text-xs text-slate-700 hover:text-rose-700 transition-colors py-2 px-2 rounded-lg hover:bg-white/60 font-medium">
                                <div class="text-rose-700">Spousal RRSP</div>
                                <div class="text-[10px] text-gray-600">Income Split</div>
                            </a>
                            <a href="calculator.html" class="text-xs text-slate-700 hover:text-indigo-700 transition-colors py-2 px-2 rounded-lg hover:bg-white/60 font-medium">
                                <div class="text-indigo-700">Calculator</div>
                                <div class="text-[10px] text-gray-600">Compound Interest</div>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Tax Link -->
                    <a href="dentist-tax.html" class="py-3 px-4 rounded-xl bg-white/60 backdrop-blur-sm hover:bg-white/80 transition-all text-slate-700 font-medium hover:text-[#1f1738] flex items-center justify-between shadow-sm hover:shadow-md border border-gray-100/50">
                        <span>Tax</span>
                        <i data-lucide="chevron-right" class="w-4 h-4"></i>
                    </a>
                    
                    <!-- CTA Button -->
                    <a href="book-appointment.html" class="mt-4 py-4 px-4 rounded-xl bg-gradient-to-r from-[#1f1738] to-[#1a1230] text-[#f5f3ed] font-semibold text-center flex items-center justify-center gap-2 shadow-lg hover:shadow-xl transition-all hover:scale-[1.02]">
                        <span>Get Started</span>
                        <i data-lucide="arrow-right" class="w-4 h-4"></i>
                    </a>
                </nav>
            </div>
        </div>
    </div>

    <main class="relative pt-28 md:pt-40 pb-12 md:pb-20 overflow-hidden bg-gray-50">
        <!-- Subtle Purple Gradient Overlay -->
        <div class="absolute inset-0 pointer-events-none z-0" style="background: radial-gradient(circle at 20% 30%, rgba(49, 36, 91, 0.15) 0%, transparent 50%), radial-gradient(circle at 80% 70%, rgba(37, 26, 61, 0.12) 0%, transparent 50%), radial-gradient(circle at 50% 50%, rgba(31, 23, 56, 0.08) 0%, transparent 70%);"></div>
        
        <div class="max-w-7xl mx-auto px-4 md:px-6 relative z-10">
            <!-- Header -->
            <div class="text-center mb-8 md:mb-12 pt-4">
                <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-[#1f1738]/10 border border-[#1f1738]/20 mb-6">
                    <i data-lucide="calculator" class="w-4 h-4 text-[#1f1738]"></i>
                    <span class="text-[#1f1738] text-xs font-semibold uppercase tracking-wider">Financial Calculator</span>
                </div>
                <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold tracking-tight text-[#1f1738] mb-4">Compound Interest Calculator</h1>
                <p class="text-lg md:text-xl text-gray-700 max-w-3xl mx-auto">
                    Calculate how your investments grow over time with compound interest, regular contributions, and various compounding frequencies.
                </p>
            </div>

            <!-- Tabs -->
            <div class="flex justify-center mb-8">
                <div class="inline-flex bg-gray-100 rounded-lg p-1">
                    <button class="tab-btn active px-6 py-2 rounded-md text-sm font-medium transition-all" onclick="switchTab('compound')">Compound</button>
                    <button class="tab-btn px-6 py-2 rounded-md text-sm font-medium transition-all" onclick="switchTab('simple')">Simple</button>
                    <button class="tab-btn px-6 py-2 rounded-md text-sm font-medium transition-all" onclick="switchTab('daily')">Daily</button>
                </div>
            </div>

            <!-- Calculator Grid -->
            <div class="grid lg:grid-cols-[350px_1fr] gap-6 md:gap-8 mb-8">
                
                <!-- Left Column: Inputs -->
                <section class="bg-white rounded-2xl p-6 md:p-8 shadow-xl border border-gray-100">
                    
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Currency</label>
                        <div class="flex items-center gap-2">
                            <select id="currencySelector" class="currency-select w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1f1738] focus:border-[#1f1738]" onchange="updateCurrencySymbol()">
                                <option value="$">$ (USD)</option>
                                <option value="€">€ (EUR)</option>
                                <option value="£">£ (GBP)</option>
                                <option value="₹">₹ (INR)</option>
                                <option value="¥">¥ (JPY)</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Initial Amount</label>
                        <div class="currency-wrapper">
                            <span class="currency-symbol">$</span>
                            <input type="number" id="initial" value="5000" class="w-full px-3 py-2 pl-8 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1f1738] focus:border-[#1f1738]">
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Interest Rate</label>
                        <div class="flex items-center gap-2">
                            <div class="currency-wrapper flex-1">
                                <input type="number" id="rate" value="5" step="0.01" class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1f1738] focus:border-[#1f1738]">
                            </div>
                            <span class="text-gray-600 font-medium">%</span>
                            <div class="toggle-container">
                                <div class="toggle-btn active" id="rateAnnual" onclick="toggleRate('annual')">Annual</div>
                                <div class="toggle-btn" id="rateMonthly" onclick="toggleRate('monthly')">Monthly</div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Compounding Frequency</label>
                        <select id="frequency" class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1f1738] focus:border-[#1f1738]">
                            <option value="12" selected>Monthly (12/yr)</option>
                            <option value="1">Annually (1/yr)</option>
                            <option value="4">Quarterly (4/yr)</option>
                            <option value="2">Semi-Annually (2/yr)</option>
                            <option value="365">Daily (365/yr)</option>
                        </select>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Duration</label>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <input type="number" id="years" value="5" class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1f1738] focus:border-[#1f1738] mb-2">
                                <label class="text-xs text-gray-600">Years</label>
                            </div>
                            <div>
                                <input type="number" id="months" value="0" class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1f1738] focus:border-[#1f1738] mb-2">
                                <label class="text-xs text-gray-600">Months</label>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Regular Contributions</label>
                        <select id="contributionType" class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1f1738] focus:border-[#1f1738]" onchange="toggleContributionDetails()">
                            <option value="none">None</option>
                            <option value="deposit">Deposits</option>
                            <option value="withdrawal">Withdrawals</option>
                        </select>
                    </div>

                    <!-- Contribution Details -->
                    <div id="contributionDetails" class="mb-6" style="display:none;">
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Deposit Amount</label>
                            <div class="currency-wrapper mb-2">
                                <span class="currency-symbol">$</span>
                                <input type="number" id="depositAmount" value="0" class="w-full px-3 py-2 pl-8 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1f1738] focus:border-[#1f1738]">
                            </div>
                            <div class="toggle-container">
                                <div class="toggle-btn active" id="depMonthly" onclick="toggleDep('monthly')">Monthly</div>
                                <div class="toggle-btn" id="depAnnually" onclick="toggleDep('annually')">Annually</div>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Annual Deposit Increase %</label>
                            <input type="number" id="depositIncrease" value="0" step="0.1" class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1f1738] focus:border-[#1f1738]">
                        </div>
                    </div>

                    <button class="btn-calc w-full px-6 py-3 bg-gradient-to-r from-[#1f1738] to-[#1a1230] text-[#f5f3ed] font-semibold rounded-lg hover:from-[#1a1230] hover:to-[#1f1538] transition-all shadow-lg hover:shadow-xl" onclick="calculate()">
                        Calculate
                    </button>

                </section>

                <!-- Right Column: Results -->
                <section>
                    
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                        <div class="bg-white rounded-xl p-6 border-l-4 border-[#1f1738] shadow-lg">
                            <div class="text-xs text-gray-600 mb-1">Future Value</div>
                            <div class="text-2xl font-bold text-[#1f1738]" id="resFutureVal">$0.00</div>
                            <div class="text-xs text-gray-500 mt-1" id="resInterest">$0.00 Interest</div>
                        </div>
                        <div class="bg-white rounded-xl p-6 border-l-4 border-gray-300 shadow-lg">
                            <div class="text-xs text-gray-600 mb-1">Principal</div>
                            <div class="text-2xl font-bold text-gray-700" id="resPrincipal">$5,000.00</div>
                        </div>
                        <div class="bg-white rounded-xl p-6 border-l-4 border-[#1f1738] shadow-lg">
                            <div class="text-xs text-gray-600 mb-1">Effective Rate</div>
                            <div class="text-2xl font-bold text-[#1f1738]" id="resEffRate">5.12%</div>
                            <div class="text-xs text-gray-500 mt-1" id="resBaseRate">Base: 5%</div>
                        </div>
                        <div class="bg-white rounded-xl p-6 border-l-4 border-[#1f1738] shadow-lg">
                            <div class="text-xs text-gray-600 mb-1">Rate of Return (RoR)</div>
                            <div class="text-2xl font-bold text-[#1f1738]" id="resRor">0.00%</div>
                        </div>
                        <div class="bg-white rounded-xl p-6 border-l-4 border-[#1f1738] shadow-lg">
                            <div class="text-xs text-gray-600 mb-1">Time to Double</div>
                            <div class="text-2xl font-bold text-[#1f1738]" id="resDouble">0y 0m</div>
                        </div>
                    </div>

                    <!-- Chart -->
                    <div class="bg-white rounded-xl p-6 shadow-lg mb-6">
                        <div class="h-[300px]">
                            <canvas id="growthChart"></canvas>
                        </div>
                    </div>

                </section>
            </div>

            <!-- Breakdown Section -->
            <section class="bg-white rounded-2xl p-6 md:p-8 shadow-xl border border-gray-100">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold text-[#1f1738]">Yearly Breakdown</h2>
                    <div class="inline-flex bg-gray-100 rounded-lg p-1">
                        <button class="b-toggle-btn px-4 py-2 rounded-md text-sm font-medium transition-all" id="viewMonthly" onclick="toggleView('monthly')">Monthly</button>
                        <button class="b-toggle-btn active px-4 py-2 rounded-md text-sm font-medium transition-all" id="viewYearly" onclick="toggleView('yearly')">Yearly</button>
                    </div>
                </div>
                
                <div class="overflow-x-auto border border-gray-200 rounded-lg">
                    <table id="breakdownTable" class="w-full min-w-[600px]">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="text-left px-4 py-3 text-sm font-semibold text-gray-700">Year</th>
                                <th class="text-right px-4 py-3 text-sm font-semibold text-gray-700">Interest</th>
                                <th class="text-right px-4 py-3 text-sm font-semibold text-gray-700">Accrued Interest</th>
                                <th class="text-right px-4 py-3 text-sm font-semibold text-gray-700">Balance</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- JS Populated -->
                        </tbody>
                    </table>
                </div>
            </section>

        </div>
    </main>

    <footer class="relative bg-[#1f1738] pt-20 pb-12 overflow-hidden">
        <!-- Decorative gradient overlay -->
        <div class="absolute inset-0 bg-gradient-to-b from-[#251a3d]/30 via-transparent to-transparent pointer-events-none"></div>
        
        <div class="max-w-7xl mx-auto px-6 relative z-10">
            <!-- Main Footer Content -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-8 mb-12">
                <!-- Brand Column -->
                <div class="lg:col-span-2">
                    <div class="mb-4">
                        <img src="https://storage.googleapis.com/msgsndr/D9EwGrg33pctwAN0KYGQ/media/689617b36346f4ec25540b89.png" alt="Virelia" class="h-10 w-auto mb-4 brightness-0 invert opacity-95">
                        <p class="text-[#f5f3ed]/90 text-sm leading-relaxed max-w-sm font-light">
                            Building a secure future for everyone, everywhere. Modern insurance solutions that adapt to your life.
                        </p>
                    </div>
                    
                    <!-- Social Links -->
                    <div class="flex items-center gap-4 mt-6">
                        <a href="#" class="w-10 h-10 rounded-full bg-[#f5f3ed]/10 hover:bg-[#f5f3ed]/20 border border-[#f5f3ed]/20 flex items-center justify-center text-[#f5f3ed]/80 hover:text-[#f5f3ed] transition-all group">
                            <i data-lucide="linkedin" class="w-4 h-4 group-hover:scale-110 transition-transform"></i>
                        </a>
                        <a href="#" class="w-10 h-10 rounded-full bg-[#f5f3ed]/10 hover:bg-[#f5f3ed]/20 border border-[#f5f3ed]/20 flex items-center justify-center text-[#f5f3ed]/80 hover:text-[#f5f3ed] transition-all group">
                            <i data-lucide="facebook" class="w-4 h-4 group-hover:scale-110 transition-transform"></i>
                        </a>
                        <a href="#" class="w-10 h-10 rounded-full bg-[#f5f3ed]/10 hover:bg-[#f5f3ed]/20 border border-[#f5f3ed]/20 flex items-center justify-center text-[#f5f3ed]/80 hover:text-[#f5f3ed] transition-all group">
                            <i data-lucide="instagram" class="w-4 h-4 group-hover:scale-110 transition-transform"></i>
                        </a>
                    </div>
                </div>
                
                <!-- Pathways Links -->
                <div>
                    <h4 class="text-[#f5f3ed] text-sm font-semibold mb-4 tracking-wide uppercase">Pathways</h4>
                    <ul class="space-y-2.5">
                        <li><a href="for-family.html" class="text-[#f5f3ed]/80 hover:text-[#f5f3ed] transition-all flex items-center gap-2 group text-sm">
                            <i data-lucide="arrow-right" class="w-3 h-3 opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all"></i>
                            <span>For Families</span>
                        </a></li>
                        <li><a href="for-agents.html" class="text-[#f5f3ed]/80 hover:text-[#f5f3ed] transition-all flex items-center gap-2 group text-sm">
                            <i data-lucide="arrow-right" class="w-3 h-3 opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all"></i>
                            <span>For Agents</span>
                        </a></li>
                    </ul>
                </div>
                
                <!-- Life Insurance Links -->
                <div>
                    <h4 class="text-[#f5f3ed] text-sm font-semibold mb-4 tracking-wide uppercase">Life Insurance</h4>
                    <ul class="space-y-2.5">
                        <li><a href="life-insurance-intro.html" class="text-[#f5f3ed]/80 hover:text-[#f5f3ed] transition-all flex items-center gap-2 group text-sm">
                            <i data-lucide="arrow-right" class="w-3 h-3 opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all"></i>
                            <span>Get Started</span>
                        </a></li>
                        <li><a href="life-insurance-types.html" class="text-[#f5f3ed]/80 hover:text-[#f5f3ed] transition-all flex items-center gap-2 group text-sm">
                            <i data-lucide="arrow-right" class="w-3 h-3 opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all"></i>
                            <span>4 Types Explained</span>
                        </a></li>
                        <li><a href="life-insurance-disability.html" class="text-[#f5f3ed]/80 hover:text-[#f5f3ed] transition-all flex items-center gap-2 group text-sm">
                            <i data-lucide="arrow-right" class="w-3 h-3 opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all"></i>
                            <span>Disability & Health</span>
                        </a></li>
                        <li><a href="life-insurance-segfunds.html" class="text-[#f5f3ed]/80 hover:text-[#f5f3ed] transition-all flex items-center gap-2 group text-sm">
                            <i data-lucide="arrow-right" class="w-3 h-3 opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all"></i>
                            <span>Advanced Planning</span>
                        </a></li>
                    </ul>
                </div>
                
                <!-- Company Links -->
                <div>
                    <h4 class="text-[#f5f3ed] text-sm font-semibold mb-4 tracking-wide uppercase">Company</h4>
                    <ul class="space-y-2.5">
                        <li><a href="index.html#leadership" class="text-[#f5f3ed]/80 hover:text-[#f5f3ed] transition-all flex items-center gap-2 group text-sm">
                            <i data-lucide="arrow-right" class="w-3 h-3 opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all"></i>
                            <span>About Us</span>
                        </a></li>
                        <li><a href="contact.html" class="text-[#f5f3ed]/80 hover:text-[#f5f3ed] transition-all flex items-center gap-2 group text-sm">
                            <i data-lucide="arrow-right" class="w-3 h-3 opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all"></i>
                            <span>Contact</span>
                        </a></li>
                        <li><a href="dentist-tax.html" class="text-[#f5f3ed]/80 hover:text-[#f5f3ed] transition-all flex items-center gap-2 group text-sm">
                            <i data-lucide="arrow-right" class="w-3 h-3 opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all"></i>
                            <span>Tax Solutions</span>
                        </a></li>
                        <li><a href="book-appointment.html" class="text-[#f5f3ed]/80 hover:text-[#f5f3ed] transition-all flex items-center gap-2 group text-sm">
                            <i data-lucide="arrow-right" class="w-3 h-3 opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all"></i>
                            <span>Book Appointment</span>
                        </a></li>
                        <li><a href="calculator.html" class="text-[#f5f3ed]/80 hover:text-[#f5f3ed] transition-all flex items-center gap-2 group text-sm">
                            <i data-lucide="arrow-right" class="w-3 h-3 opacity-0 group-hover:opacity-100 group-hover:translate-x-1 transition-all"></i>
                            <span>Interest Calculator</span>
                        </a></li>
                    </ul>
                </div>
                
                <!-- Newsletter/CTA -->
                <div>
                    <h4 class="text-[#f5f3ed] text-sm font-semibold mb-4 tracking-wide uppercase">Stay Connected</h4>
                    <p class="text-[#f5f3ed]/70 text-xs mb-3 leading-relaxed">Get the latest updates and insights delivered to your inbox.</p>
                    <form class="space-y-2.5">
                        <input type="email" placeholder="Enter your email" class="w-full px-3 py-2.5 rounded-lg bg-[#f5f3ed]/10 border border-[#f5f3ed]/20 text-[#f5f3ed] placeholder:text-[#f5f3ed]/40 focus:outline-none focus:ring-2 focus:ring-[#f5f3ed]/30 focus:border-[#f5f3ed]/40 transition-all text-sm">
                        <button type="submit" class="w-full px-3 py-2.5 bg-[#f5f3ed] text-[#1f1738] rounded-lg font-semibold text-sm hover:bg-[#f5f3ed]/90 transition-all flex items-center justify-center gap-2 group">
                            Subscribe
                            <i data-lucide="arrow-right" class="w-4 h-4 group-hover:translate-x-1 transition-transform"></i>
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Bottom Bar -->
            <div class="border-t border-[#f5f3ed]/10 pt-6">
                <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                    <div class="flex flex-wrap items-center gap-6 text-xs text-[#f5f3ed]/60">
                        <p>© 2024 Virelia Insurance Group. All rights reserved.</p>
                        <span class="hidden md:inline">•</span>
                        <a href="privacy-policy.html" class="hover:text-[#f5f3ed] transition-colors">Privacy Policy</a>
                        <span class="hidden md:inline">•</span>
                        <a href="terms-of-service.html" class="hover:text-[#f5f3ed] transition-colors">Terms of Service</a>
                        <span class="hidden md:inline">•</span>
                        <a href="faq.html" class="hover:text-[#f5f3ed] transition-colors">FAQ</a>
                    </div>
                    <div class="flex items-center gap-2 text-xs text-[#f5f3ed]/50">
                        <i data-lucide="heart" class="w-3 h-3 text-[#f5f3ed]/40"></i>
                        <span>Made with care for your future</span>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script>
        lucide.createIcons();
        
        // Mobile Menu Toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenuClose = document.getElementById('mobile-menu-close');
        const mobileMenu = document.getElementById('mobile-menu');
        
        // Open mobile menu
        if (mobileMenuBtn && mobileMenu) {
            mobileMenuBtn.addEventListener('click', () => {
                mobileMenu.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                lucide.createIcons();
            });
        }
        
        // Close mobile menu
        if (mobileMenuClose && mobileMenu) {
            mobileMenuClose.addEventListener('click', () => {
                mobileMenu.classList.add('hidden');
                document.body.style.overflow = '';
                lucide.createIcons();
            });
        }
        
        // Close on backdrop click
        if (mobileMenu) {
            mobileMenu.addEventListener('click', (e) => {
                if (e.target === mobileMenu || e.target.classList.contains('backdrop-blur-sm')) {
                    mobileMenu.classList.add('hidden');
                    document.body.style.overflow = '';
                }
            });
            
            // Close when clicking any link
            mobileMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    mobileMenu.classList.add('hidden');
                    document.body.style.overflow = '';
                });
            });
        }

        // --- State Management ---
        let chartInstance = null;
        let currentTab = 'compound';
        let currentView = 'yearly';
        let currencySymbol = '$';
        let calculationData = [];
        
        // --- Configuration ---
        const colors = {
            primary: '#1f1738',
            primaryFade: 'rgba(31, 23, 56, 0.1)'
        };

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            initChart();
            toggleContributionDetails(); // Show/hide contribution details based on initial selection
            calculate();
            setupTableInteractions();
        });

        // --- UI Helpers ---
        function formatMoney(amount) {
            return currencySymbol + amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function updateCurrencySymbol() {
            currencySymbol = document.getElementById('currencySelector').value;
            document.querySelectorAll('.currency-symbol').forEach(el => el.innerText = currencySymbol);
            calculate();
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active', 'bg-[#1f1738]', 'text-white'));
            event.target.classList.add('active', 'bg-[#1f1738]', 'text-white');
            
            const freqSelect = document.getElementById('frequency');
            if (tab === 'daily') {
                freqSelect.value = '365';
            } else if (tab === 'simple') {
                freqSelect.value = '1';
            } else {
                freqSelect.value = '12';
            }
            calculate();
        }

        function toggleRate(type) {
            document.getElementById('rateAnnual').classList.toggle('active', type === 'annual');
            document.getElementById('rateMonthly').classList.toggle('active', type === 'monthly');
            calculate();
        }

        function toggleDep(type) {
            document.getElementById('depMonthly').classList.toggle('active', type === 'monthly');
            document.getElementById('depAnnually').classList.toggle('active', type === 'annually');
            calculate();
        }

        function toggleContributionDetails() {
            const contribType = document.getElementById('contributionType').value;
            const detailsDiv = document.getElementById('contributionDetails');
            if (contribType === 'none') {
                detailsDiv.style.display = 'none';
            } else {
                detailsDiv.style.display = 'block';
            }
            calculate();
        }

        function toggleView(view) {
            currentView = view;
            document.getElementById('viewMonthly').classList.toggle('active', view === 'monthly');
            document.getElementById('viewYearly').classList.toggle('active', view === 'yearly');
            document.getElementById('viewMonthly').classList.toggle('bg-[#1f1738]', view === 'monthly');
            document.getElementById('viewMonthly').classList.toggle('text-white', view === 'monthly');
            document.getElementById('viewYearly').classList.toggle('bg-[#1f1738]', view === 'yearly');
            document.getElementById('viewYearly').classList.toggle('text-white', view === 'yearly');
            renderTable();
        }

        // --- Core Calculation Logic ---
        function calculate() {
            // 1. Get Inputs
            const P = parseFloat(document.getElementById('initial').value) || 0;
            let r_raw = parseFloat(document.getElementById('rate').value) || 0;
            
            // Rate Logic
            const isRateMonthly = document.getElementById('rateMonthly').classList.contains('active');
            // Always convert percentage to decimal (user enters 5 for 5%, whether annual or monthly)
            let r_decimal = r_raw / 100;
            
            // Frequency
            const n = parseInt(document.getElementById('frequency').value);
            
            // Time
            const years = parseInt(document.getElementById('years').value) || 0;
            const months = parseInt(document.getElementById('months').value) || 0;
            const t_total = years + (months / 12);

            // Contributions
            const contribType = document.getElementById('contributionType').value;
            let PMT = 0;
            // Get the amount from depositAmount field (used for both deposits and withdrawals)
            const depositAmountValue = parseFloat(document.getElementById('depositAmount').value) || 0;
            if (contribType === 'deposit') {
                PMT = depositAmountValue;
            } else if (contribType === 'withdrawal') {
                PMT = depositAmountValue; // For withdrawals, this is the withdrawal amount
            }
            const isDepMonthly = document.getElementById('depMonthly').classList.contains('active');
            const depositGrowth = parseFloat(document.getElementById('depositIncrease').value) / 100;

            // --- EXACT MATH: Effective Annual Rate (EAR) ---
            // If monthly rate is selected, convert to annual equivalent first
            // Monthly rate of r% per month = (1 + r/100)^12 - 1 annual rate
            if (isRateMonthly) {
                // User entered monthly rate (e.g., 5% per month)
                // Convert to annual rate: (1 + r_monthly)^12 - 1
                const monthlyRate = r_decimal;
                const annualRate = Math.pow(1 + monthlyRate, 12) - 1;
                r_decimal = annualRate;
            }
            // EAR = (1 + r/n)^n - 1 (where r is now the annual rate in decimal form)

            let effRate = 0;
            if (r_decimal > 0) {
                effRate = Math.pow(1 + (r_decimal / n), n) - 1;
            }
            
            // --- EXACT MATH: Time to Double ---
            // t = ln(2) / (n * ln(1 + r/n))
            let tDoubleYears = 0;
            if (r_decimal > 0) {
                tDoubleYears = Math.log(2) / (n * Math.log(1 + (r_decimal / n)));
            }
            const yDouble = Math.floor(tDoubleYears);
            const mDouble = Math.round((tDoubleYears - yDouble) * 12);

            // --- LOOP SETUP ---
            // To support the "Monthly/Yearly" view toggle accurately for any 'n', 
            // we calculate the Effective Monthly Rate to iterate step-by-step.
            // This ensures the table matches the exact math over the duration.
            let ratePerMonth;
            if (r_decimal === 0) {
                ratePerMonth = 0;
            } else {
                // r_month = (1 + r/n)^(n/12) - 1
                ratePerMonth = Math.pow(1 + (r_decimal / n), n / 12) - 1;
            }

            calculationData = [];
            let balance = P;
            let totalInterest = 0;
            let currentPMT = PMT;
            let lastYearDeposit = 0; // Track when annual deposits were made
            
            // Total months in loop
            const totalMonths = Math.ceil(t_total * 12);

            for (let i = 0; i <= totalMonths; i++) {
                const timeYears = i / 12;
                let periodInterest = 0;

                if (i > 0) {
                    // Interest: I_k = B_{k-1} * i (where i is the effective rate for the period)
                    periodInterest = balance * ratePerMonth;
                    
                    // Update Totals
                    balance += periodInterest;
                    totalInterest += periodInterest;
                    
                    // Contributions (Added/subtracted at end of period/month)
                    if (contribType === 'deposit') {
                        // Handle monthly deposits
                        if (isDepMonthly) {
                            balance += currentPMT;
                            // Increase PMT annually at the end of each year (after the 12th deposit)
                            // Check happens after deposit, so increase applies to next year
                            if (i % 12 === 0 && i > 0 && depositGrowth > 0) {
                                currentPMT = currentPMT * (1 + depositGrowth);
                            }
                        } else {
                            // Handle annual deposits (at end of each year)
                            if (i % 12 === 0 && i > 0) {
                                balance += currentPMT;
                                // Increase PMT for next year (after this year's deposit)
                                if (depositGrowth > 0) {
                                    currentPMT = currentPMT * (1 + depositGrowth);
                                }
                            }
                        }
                    } else if (contribType === 'withdrawal') {
                        // Handle withdrawals (subtract from balance)
                        if (isDepMonthly) {
                            balance -= currentPMT;
                            // Increase withdrawal amount annually at the end of each year
                            if (i % 12 === 0 && i > 0 && depositGrowth > 0) {
                                currentPMT = currentPMT * (1 + depositGrowth);
                            }
                        } else {
                            // Annual withdrawals
                            if (i % 12 === 0 && i > 0) {
                                balance -= currentPMT;
                                // Increase withdrawal amount for next year
                                if (depositGrowth > 0) {
                                    currentPMT = currentPMT * (1 + depositGrowth);
                                }
                            }
                        }
                    }
                }

                calculationData.push({
                    period: i,
                    year: Math.floor(i/12),
                    month: i % 12,
                    interest: periodInterest,
                    totalInterest: totalInterest,
                    balance: balance
                });
            }

            // --- Update UI Results ---
            
            // Future Value
            const finalBalance = calculationData[calculationData.length - 1].balance;
            const finalTotalInt = calculationData[calculationData.length - 1].totalInterest;
            
            // Calculate total principal (initial + total deposits made, or initial - total withdrawals)
            // This is the sum of all deposits/withdrawals, accounting for annual increases
            let totalPrincipal = P;
            if (PMT > 0) {
                let contributionPMT = PMT;
                if (isDepMonthly) {
                    // Monthly contributions: sum over all months with annual increases
                    for (let month = 1; month <= totalMonths; month++) {
                        if (contribType === 'deposit') {
                            totalPrincipal += contributionPMT;
                        } else if (contribType === 'withdrawal') {
                            totalPrincipal -= contributionPMT;
                        }
                        // Increase contribution amount annually
                        if (month % 12 === 0 && depositGrowth > 0) {
                            contributionPMT = contributionPMT * (1 + depositGrowth);
                        }
                    }
                } else {
                    // Annual contributions: sum over all years with increases
                    const numYears = Math.ceil(t_total);
                    for (let year = 1; year <= numYears; year++) {
                        if (contribType === 'deposit') {
                            totalPrincipal += contributionPMT;
                        } else if (contribType === 'withdrawal') {
                            totalPrincipal -= contributionPMT;
                        }
                        if (depositGrowth > 0) {
                            contributionPMT = contributionPMT * (1 + depositGrowth);
                        }
                    }
                }
            }
            
            document.getElementById('resFutureVal').innerText = formatMoney(finalBalance);
            document.getElementById('resInterest').innerText = formatMoney(finalTotalInt) + " Interest";
            document.getElementById('resPrincipal').innerText = formatMoney(totalPrincipal);
            
            // Effective Rate
            // Format: "5% -> 5.12%" or similar based on user input
            const baseRateStr = (isRateMonthly ? (r_raw * 12).toFixed(2) : r_raw.toFixed(2)) + "%";
            const effRateStr = (effRate * 100).toFixed(2) + "%";
            
            document.getElementById('resBaseRate').innerText = `Base: ${baseRateStr}`;
            document.getElementById('resEffRate').innerText = `${baseRateStr} → ${effRateStr}`;
            
            // RoR: (Final Balance - Total Principal) / Total Principal
            // This accounts for deposits/withdrawals in the principal
            let rorText = "0.00%";
            if (totalPrincipal > 0) {
                const ror = ((finalBalance - totalPrincipal) / totalPrincipal) * 100;
                rorText = ror.toFixed(2) + "%";
            } else if (P > 0) {
                // Fallback to simple RoR if no contributions
                const ror = ((finalBalance - P) / P) * 100;
                rorText = ror.toFixed(2) + "%";
            } else {
                // Handle P=0 scenario (e.g., saving from scratch)
                rorText = "N/A";
            }
            document.getElementById('resRor').innerText = rorText;
            
            // Double Time
            if (r_decimal > 0) {
                document.getElementById('resDouble').innerText = `${yDouble}y ${mDouble}m`;
            } else {
                document.getElementById('resDouble').innerText = "Never";
            }

            updateChart();
            renderTable();
        }

        // --- Chart.js Integration ---
        function initChart() {
            const ctx = document.getElementById('growthChart').getContext('2d');
            const gradient = ctx.createLinearGradient(0, 0, 0, 300);
            gradient.addColorStop(0, 'rgba(31, 23, 56, 0.4)');
            gradient.addColorStop(1, 'rgba(31, 23, 56, 0.0)');

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Balance',
                        data: [],
                        borderColor: '#1f1738',
                        backgroundColor: gradient,
                        borderWidth: 2,
                        pointRadius: 2,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#FFFFFF',
                        pointBorderColor: '#1f1738',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#333',
                            titleFont: { family: 'Inter' },
                            bodyFont: { family: 'Inter' },
                            padding: 10,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return 'Balance: ' + currencySymbol + context.parsed.y.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                                }
                            }
                        }
                    },
                    scales: {
                        x: { grid: { display: false }, ticks: { font: { family: 'Inter' } } },
                        y: {
                            grid: { borderDash: [5, 5], color: '#eee' },
                            ticks: { 
                                font: { family: 'Inter' },
                                callback: function(value) { return currencySymbol + value/1000 + 'k'; }
                            }
                        }
                    },
                    onHover: (event, chartElement) => {
                        const tableRows = document.querySelectorAll('#breakdownTable tbody tr');
                        tableRows.forEach(row => row.classList.remove('selected-row'));
                        
                        if (chartElement.length > 0) {
                            const index = chartElement[0].index;
                            // Only highlight if row exists (due to yearly/monthly filtering)
                            const row = tableRows[index];
                            if (row) {
                                row.classList.add('selected-row');
                                row.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                            }
                        }
                    }
                }
            });
        }

        function updateChart() {
            if (!chartInstance) return;
            
            let labels = [];
            let data = [];
            let subset = [];
            
            if (currentView === 'yearly') {
                for(let i=0; i<calculationData.length; i+=12) subset.push(calculationData[i]);
            } else {
                subset = calculationData;
            }

            labels = subset.map(d => d.period === 0 ? "Start" : (currentView === 'yearly' ? `Year ${d.year}` : `${d.month}/${d.year}`));
            data = subset.map(d => d.balance);

            chartInstance.data.labels = labels;
            chartInstance.data.datasets[0].data = data;
            chartInstance.update();
        }

        // --- Table Rendering ---
        function renderTable() {
            const tbody = document.querySelector('#breakdownTable tbody');
            tbody.innerHTML = '';
            
            // Filter data based on view
            let displayData = [];
            if (currentView === 'yearly') {
                for(let i=0; i<calculationData.length; i+=12) {
                    displayData.push(calculationData[i]);
                }
            } else {
                displayData = calculationData;
            }

            displayData.forEach((row, index) => {
                const tr = document.createElement('tr');
                
                // Year Label
                const tdLabel = document.createElement('td');
                tdLabel.className = 'px-4 py-3 text-sm text-gray-600';
                if (row.period === 0) tdLabel.innerText = "Start";
                else if (currentView === 'yearly') tdLabel.innerText = row.year;
                else {
                    // Format Month/Year
                    const date = new Date(); 
                    date.setMonth(row.month - 1); 
                    date.setFullYear(row.year);
                    tdLabel.innerText = date.toLocaleDateString('en-US', { month: 'short', year: '2-digit'});
                }
                tr.appendChild(tdLabel);

                // Interest (Editable)
                const tdInt = document.createElement('td');
                tdInt.className = 'px-4 py-3 text-sm text-right';
                tdInt.contentEditable = "true";
                tdInt.innerText = formatMoney(row.interest);
                tdInt.dataset.index = row.period;
                tdInt.classList.add('editable-cell');
                tr.appendChild(tdInt);

                // Accrued Interest
                const tdAcc = document.createElement('td');
                tdAcc.className = 'px-4 py-3 text-sm text-right text-gray-700';
                tdAcc.innerText = formatMoney(row.totalInterest);
                tr.appendChild(tdAcc);

                // Balance
                const tdBal = document.createElement('td');
                tdBal.className = 'px-4 py-3 text-sm text-right font-bold text-[#1f1738]';
                tdBal.innerText = formatMoney(row.balance);
                tr.appendChild(tdBal);

                // Hover Sync
                tr.addEventListener('mouseenter', () => {
                   if (chartInstance) {
                       const chartIndex = currentView === 'yearly' ? index : index;
                       chartInstance.setActiveElements([{ datasetIndex: 0, index: chartIndex }]);
                       chartInstance.update();
                   }
                });
                tr.addEventListener('mouseleave', () => {
                    if (chartInstance) {
                        chartInstance.setActiveElements([]);
                        chartInstance.update();
                    }
                });

                tbody.appendChild(tr);
            });
        }

        function setupTableInteractions() {
            document.querySelector('#breakdownTable tbody').addEventListener('blur', (e) => {
                if (e.target.classList.contains('editable-cell')) {
                    handleEdit(e.target);
                }
            }, true);
            
            document.querySelector('#breakdownTable tbody').addEventListener('keydown', (e) => {
                if (e.target.classList.contains('editable-cell') && e.key === 'Enter') {
                    e.preventDefault();
                    e.target.blur();
                }
            });
        }

        function handleEdit(cell) {
            const originalIndex = parseInt(cell.dataset.index);
            let newValStr = cell.innerText.replace(/[^0-9.-]/g, '');
            const newInterest = parseFloat(newValStr);

            if (isNaN(newInterest)) {
                cell.innerText = formatMoney(calculationData[originalIndex].interest);
                return;
            }

            // --- Recalc Forward Logic ---
            const oldBalBefore = originalIndex === 0 ? 0 : calculationData[originalIndex-1].balance;
            const oldTotalIntBefore = originalIndex === 0 ? 0 : calculationData[originalIndex-1].totalInterest;

            calculationData[originalIndex].interest = newInterest;
            calculationData[originalIndex].totalInterest = oldTotalIntBefore + newInterest;
            
            let PMT = parseFloat(document.getElementById('depositAmount').value) || 0;
            const contribType = document.getElementById('contributionType').value;
            if(contribType === 'withdrawal') PMT = -PMT;

            calculationData[originalIndex].balance = oldBalBefore + newInterest + PMT;

            const r_raw = parseFloat(document.getElementById('rate').value) || 0;
            const isRateMonthly = document.getElementById('rateMonthly').classList.contains('active');
            const r_decimal = isRateMonthly ? r_raw : r_raw / 100;
            const n = parseInt(document.getElementById('frequency').value);
            let ratePerMonth = (r_decimal === 0) ? 0 : Math.pow(1 + (r_decimal / n), n / 12) - 1;

            for (let i = originalIndex + 1; i < calculationData.length; i++) {
                const prevRow = calculationData[i-1];
                let interest = prevRow.balance * ratePerMonth;
                calculationData[i].interest = interest;
                calculationData[i].totalInterest = prevRow.totalInterest + interest;
                calculationData[i].balance = prevRow.balance + interest + PMT; 
            }

            cell.innerText = formatMoney(newInterest);
            
            const final = calculationData[calculationData.length - 1];
            document.getElementById('resFutureVal').innerText = formatMoney(final.balance);
            document.getElementById('resInterest').innerText = formatMoney(final.totalInterest) + " Interest";
            
            let rorText = "0.00%";
            const P = parseFloat(document.getElementById('initial').value) || 0;
            if (P > 0) {
                const ror = ((final.balance - P) / P) * 100;
                rorText = ror.toFixed(2) + "%";
            } else {
                rorText = "N/A";
            }
            document.getElementById('resRor').innerText = rorText;

            renderTable();
            updateChart();
        }

    </script>
</body>
</html>
